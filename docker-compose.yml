# Transcodarr - Jellyfin with rffmpeg
# Distributed transcoding to Apple Silicon Macs

services:
  jellyfin:
    image: linuxserver/jellyfin:latest
    container_name: jellyfin
    environment:
      - PUID=1000          # Change to your user ID
      - PGID=1000          # Change to your group ID
      - TZ=Europe/Amsterdam
      - JELLYFIN_PublishedServerUrl=YOUR_SERVER_IP
      - UMASK=022
      # Enable rffmpeg mod for distributed transcoding
      - DOCKER_MODS=linuxserver/mods:jellyfin-rffmpeg
      - FFMPEG_PATH=/usr/local/bin/ffmpeg
    volumes:
      - /volume2/docker/jellyfin:/config
      - /path/to/media:/data/media
      # Transcoding cache (local recommended for stability)
      - /volume2/docker/jellyfin/cache:/config/cache
    ports:
      - 8096:8096/tcp      # HTTP
      - 8920:8920/tcp      # HTTPS
      - 7359:7359/udp      # Discovery
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true

# Optional: Use NFS volume for transcoding cache (if Mac is NFS server)
# volumes:
#   macmini-cache:
#     driver: local
#     driver_opts:
#       type: nfs
#       o: addr=192.168.175.159,rw,nolock,vers=3,soft,timeo=10,retrans=3
#       device: ":/Users/Shared/jellyfin-cache"
